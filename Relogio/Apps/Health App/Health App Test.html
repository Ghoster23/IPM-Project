<!DOCTYPE html>
<html>
    <head>
        <title>Sa&uacute;de - Teste</title>
        <link rel="stylesheet" href="../../style (Watch).css">
        <link rel="stylesheet" href="../style (Menu).css">
        <link rel="stylesheet" href="style (Health App).css">
        <link rel="stylesheet" href="style (Health App Test).css">
    </head>

    <body>
        <a href="../../../index.html">
            <img id="Back_Arrow" src="../../../Images/Arrow.jpg">
        </a>
    
        <div id="Clock">
            <!-- Dark Background -->
            <div id="Touch_Screen">
                <div class="menu">
                    <!-- Loading -->
                    <canvas id="Loading"></canvas>
                    <!-- Result -->
                    <div id="Result"> Resultado<br>do teste:</div>
                    <!-- Result Text -->
                    <span id="Result_Text"> place_holder_text</span>
                </div>
    
                <!-- Back Button -->
                <a href="Health App.html">
                    <img id="Back" src="../Images/back.png">
                </a>    
            </div>

            <!-- Bezzle --> 
            <img id="Bezel" src="../../Images/Bezel.png">

            <!-- Button -->
            <a href="../../Watch.html">
                <div id="Button"></div>
            </a>
        </div>
        
        <!-- Functions for the tests -->
        <script>

            function getRandomArbitrary(min, max) {
                return Math.random() * (max - min) + min;
            }

            //decide on the string to put for the result :)
            function testResults() {
                var testtype     = localStorage.getItem("testtype");
                var resultstring = "default";
                var goodResult   = false;
                var randomNumber;

                switch(testtype) {
                    //teste alcoolemia
                    case "1":
                        randomNumber = getRandomArbitrary(0,1.5).toFixed(2);
                        resultstring = randomNumber.toString() + "%";
                        if (randomNumber < 0.5) { goodResult = true; }
                        break;

                    //tete de pressao arterial
                    case "2":
                        randomNumber = getRandomArbitrary(0,190).toFixed(0);
                        var pressao2 = getRandomArbitrary(0,120).toFixed(0);
                        resultstring = randomNumber.toString() + "/" + pressao2.toString() + "\nmmHg";
                        document.getElementById('Result_Text').style.top = "100px";
                        if (randomNumber < 120 && pressao2 < 80) { goodResult = true; }
                        break;

                    //teste de narcoticos
                    case "3":
                        var narcoticos = ["Nao foram\nencontradas\nsubstancias", "Cannabis", "Ecstasy", "Heroina", "Cocaina", "Anfetaminas", "LSD"];
                        randomNumber = getRandomArbitrary(0,6).toFixed(0);
                        switch(randomNumber) {
                            case "0":
                                document.getElementById("Result_Text").style.top = "90px";
                                document.getElementById("Result_Text").style.fontSize = "21px";
                                goodResult = true;
                                break;
                            case "5":
                                document.getElementById("Result_Text").style.fontSize = "25px";
                                break;
                        }
                        resultstring = narcoticos[randomNumber];
                        break;

                    //ritmo cardiaco
                    case "4":
                        randomNumber = getRandomArbitrary(49,121).toFixed(0);
                        resultstring = randomNumber.toString() + " bpm";
                        if (60 < randomNumber && randomNumber < 100) { goodResult = true; }
                        break;

                    //teste de glicÃ©mia
                    case "5":
                        randomNumber = getRandomArbitrary(40,200).toFixed(0);
                        resultstring = randomNumber.toString() + "\nmg/dl";
                        document.getElementById("Result_Text").style.top = "100px";
                        if (70 < randomNumber && randomNumber < 140) { goodResult = true; }
                        break;
                }

                document.getElementById('Result_Text').textContent = resultstring;
                if (goodResult) {
                    document.getElementById("Touch_Screen").style.backgroundColor = "#93DB70"; //green
                } else {
                    document.getElementById("Touch_Screen").style.backgroundColor = "#DE1F26"; //red
                }
            }

            //take care of making the circular progress bar :o
            var ctx        = document.getElementById('Loading').getContext('2d');
            var percentage = 0;
            var start      = 4.72;
            var cw         = ctx.canvas.width  = 210;
            var ch         = ctx.canvas.height = 210;
            var color      = localStorage.getItem("color");

            var diff;
            function progressSim() {
                diff = ((percentage / 100) * Math.PI*2*10).toFixed(2);
                ctx.clearRect(0, 0, cw, ch);
                ctx.lineWidth   = 40;
                ctx.fillStyle   = "#FFFFFF";
                ctx.strokeStyle = color;

                ctx.font      = "40px sans-serif";
                ctx.textAlign = "center";

                ctx.fillText(percentage+'%', cw*.5+5, ch*.5+15, cw);
                ctx.beginPath();
                ctx.arc(cw/2, ch/2, cw/2-10 , start, diff/10+start, false);
                ctx.stroke();
                if (percentage >= 100) {
                    //upon finishing clear canvas and make visible test results
                    clearTimeout(sim);
                    
                    ctx.clearRect(0, 0, cw, ch);
                    ctx.arc(cw/2, ch/2, cw/2-10 , start, diff/10+start, false);
                    ctx.stroke();
                    
                    testResults();
                    document.getElementById('Result').style.visibility = "visible";
                    document.getElementById('Result_Text').style.visibility = "visible";
                }
                percentage++;
            }
            var sim = setInterval(progressSim, 30);
        </script>

    </body>
</html>